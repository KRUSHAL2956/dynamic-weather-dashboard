<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windy API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #windy { width: 100%; height: 400px; border: 1px solid #ccc; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Windy API Test</h1>
    <div id="status">Testing Windy API...</div>
    <div id="windy"></div>
    
    <div class="log info">
        <strong>API Key:</strong> TdUZdrZjZwNnHKrv1saTvQ14Us3WCExk
    </div>
    
    <script src="https://api.windy.com/assets/libBoot.js"></script>
    <script>
        function log(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            statusDiv.appendChild(logDiv);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function testWindyAPI() {
            log('Starting Windy API test...', 'info');
            
            // Check if windyInit is available
            if (typeof windyInit === 'undefined') {
                log('‚ùå windyInit function not found - API script not loaded properly', 'error');
                return;
            }
            
            log('‚úÖ windyInit function found', 'success');
            
            const options = {
                key: 'TdUZdrZjZwNnHKrv1saTvQ14Us3WCExk',
                lat: 22.2896515,
                lon: 73.3636423,
                zoom: 8
            };
            
            log(`Initializing Windy with options: ${JSON.stringify(options)}`, 'info');
            
            try {
                windyInit(options, windyAPI => {
                    log('üéâ Windy API callback received!', 'success');
                    
                    const { map, store, picker, overlays, utils } = windyAPI;
                    
                    if (map) {
                        log('‚úÖ Map instance created successfully', 'success');
                    }
                    
                    if (store) {
                        log('‚úÖ Store instance available', 'success');
                        
                        // Test setting overlay
                        try {
                            store.set('overlay', 'wind');
                            log('‚úÖ Successfully set wind overlay', 'success');
                        } catch (e) {
                            log(`‚ùå Failed to set overlay: ${e.message}`, 'error');
                        }
                    }
                    
                    if (picker) {
                        log('‚úÖ Picker instance available', 'success');
                        
                        // Test opening picker
                        try {
                            picker.open({ lat: 22.2896515, lon: 73.3636423 });
                            log('‚úÖ Successfully opened picker at coordinates', 'success');
                        } catch (e) {
                            log(`‚ùå Failed to open picker: ${e.message}`, 'error');
                        }
                    }
                    
                    if (overlays) {
                        log(`‚úÖ Available overlays: ${Object.keys(overlays).join(', ')}`, 'success');
                    }
                    
                    log('üéØ Windy API test completed successfully!', 'success');
                });
            } catch (error) {
                log(`‚ùå Failed to initialize Windy API: ${error.message}`, 'error');
            }
        }
        
        // Wait for script to load
        window.addEventListener('load', () => {
            log('Page loaded, waiting 2 seconds for scripts...', 'info');
            setTimeout(testWindyAPI, 2000);
        });
        
        // Also check periodically
        let checkCount = 0;
        const checkInterval = setInterval(() => {
            checkCount++;
            if (typeof windyInit !== 'undefined') {
                log('windyInit detected!', 'info');
                clearInterval(checkInterval);
                testWindyAPI();
            } else if (checkCount > 10) {
                log('‚ùå windyInit not found after 10 seconds', 'error');
                clearInterval(checkInterval);
            } else {
                log(`Waiting for windyInit... (${checkCount}/10)`, 'info');
            }
        }, 1000);
    </script>
</body>
</html>